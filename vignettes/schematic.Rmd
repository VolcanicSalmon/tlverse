---
title: "tlverse Schematic Data"
output:
  html_document:
  df_print: paged
---

<!-- TODO: backport some of the book stuff here, or at least link it   -->
# Setup
```{r setup}
knitr::opts_chunk$set(echo=FALSE, results = "hide")
library(ggplot2)
library(sl3)
library(tmle3)
library(tlverse)
library(MASS)
library(data.table)
library(viridis)
set.seed(1234)
```

# DGP

We define the DGP using a series of R functions:

<!-- TODO: think about how to specify these, where they should live in the tlverse -->
```{r dgp, echo = TRUE}
print(schematic_g)
print(schematic_Q)
print(gen_schematic)
```

# Grid
```{r grid}
schematic_grid <- make_schematic_grid()
```
# Psi and Bounds

```{r calc_meta}

tsm_0 <- schematic_grid[,list(Y=mean(EY_0)), by = list(A, type)]
ate_0 <- tsm_0$Y[2]-tsm_0$Y[1]
lims <- list(W=range(schematic_grid$W),
             A=range(schematic_grid$A),
             Y=range(schematic_grid$EY))
schematic_meta <- list(tsm_0 = tsm_0,
                       ate_0 = ate_0,
                       lims = lims)
```

# Plot

```{r true_dgd_plot}
plot_schematic(schematic, schematic_grid, schematic_meta)
```


<!-- Might as well save the data while we're here -->
```{r save_data, echo=FALSE}
# TODO: Document your data (see 'https://r-pkgs.org/data.html')
usethis::use_data(schematic,
                  schematic_grid,
                  schematic_meta,
                  overwrite = TRUE)
```
